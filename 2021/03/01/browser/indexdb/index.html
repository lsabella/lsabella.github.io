<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Baishu"><meta name="copyright" content="Baishu"><meta name="generator" content="Hexo 5.4.0"><meta name="theme" content="hexo-theme-yun"><title>æµè§ˆå™¨å¦‚ä½•æŒä¹…åŒ–ç¼“å­˜å¤§é‡æ•°æ® - IndexDB | Baishuçš„åšå®¢</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"example.com","root":"/","title":"ç™½èˆ’å°ç«™","version":"1.6.2","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"æœç´¢...","empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹: ${query}","hits":"æ‰¾åˆ° ${hits} æ¡ç»“æœ","hits_time":"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼ˆç”¨æ—¶ ${time} æ¯«ç§’ï¼‰"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="èƒŒæ™¯æ¦‚è¿°  è¿™é‡Œæ‰€è¯´çš„æ•°æ®æŒä¹…åŒ–æ˜¯é’ˆå¯¹æµè§ˆå™¨è€Œè¨€ï¼Œä¹Ÿå¯ç®€ç§°ä¸ºæµè§ˆå™¨ç¼“å­˜ã€‚  æµè§ˆå™¨ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨ç«¯åœ¨æœ¬åœ°ä¿å­˜æ•°æ®è¿›è¡Œå¿«é€Ÿè¯»å–ä»¥é¿å…é‡å¤èµ„æºè¯·æ±‚ã€‚  ç°ä»£æµè§ˆå™¨ä¸»è¦æœ‰9ç§ç¼“å­˜æœºåˆ¶ï¼šHttpæ–‡ä»¶ç¼“å­˜ã€LocalStorageã€SessionStorageã€indexDBã€Web SQLã€Cookieã€CacheStorageã€Application Cacheã€Flashç¼“å­˜ - ã€Šç°ä»£å‰ç«¯æŠ€æœ¯è§£æã€‹">
<meta property="og:type" content="article">
<meta property="og:title" content="æµè§ˆå™¨å¦‚ä½•æŒä¹…åŒ–ç¼“å­˜å¤§é‡æ•°æ® - IndexDB">
<meta property="og:url" content="http://example.com/2021/03/01/browser/indexdb/index.html">
<meta property="og:site_name" content="Baishuçš„åšå®¢">
<meta property="og:description" content="èƒŒæ™¯æ¦‚è¿°  è¿™é‡Œæ‰€è¯´çš„æ•°æ®æŒä¹…åŒ–æ˜¯é’ˆå¯¹æµè§ˆå™¨è€Œè¨€ï¼Œä¹Ÿå¯ç®€ç§°ä¸ºæµè§ˆå™¨ç¼“å­˜ã€‚  æµè§ˆå™¨ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨ç«¯åœ¨æœ¬åœ°ä¿å­˜æ•°æ®è¿›è¡Œå¿«é€Ÿè¯»å–ä»¥é¿å…é‡å¤èµ„æºè¯·æ±‚ã€‚  ç°ä»£æµè§ˆå™¨ä¸»è¦æœ‰9ç§ç¼“å­˜æœºåˆ¶ï¼šHttpæ–‡ä»¶ç¼“å­˜ã€LocalStorageã€SessionStorageã€indexDBã€Web SQLã€Cookieã€CacheStorageã€Application Cacheã€Flashç¼“å­˜ - ã€Šç°ä»£å‰ç«¯æŠ€æœ¯è§£æã€‹">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/images/browser/browser_01.png">
<meta property="og:image" content="http://example.com/images/browser/browser_02.png">
<meta property="og:image" content="http://example.com/images/browser/apply_discard.png">
<meta property="og:image" content="http://example.com/images/browser/indexdb_database.png">
<meta property="og:image" content="http://example.com/images/browser/idb_demo_.gif">
<meta property="og:image" content="http://example.com/images/browser/quota_error.png">
<meta property="og:image" content="http://example.com/images/browser/redux_persist.png">
<meta property="article:published_time" content="2021-03-01T01:17:21.000Z">
<meta property="article:modified_time" content="2021-03-05T08:18:31.000Z">
<meta property="article:author" content="Baishu">
<meta property="article:tag" content="æµè§ˆå™¨">
<meta property="article:tag" content="æ•°æ®æŒä¹…åŒ–">
<meta property="article:tag" content="IndexDB">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/images/browser/browser_01.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="æ–‡ç« ç›®å½•"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="ç«™ç‚¹æ¦‚è§ˆ"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Baishu"><img width="96" loading="lazy" src="/images/avatar.jpg" alt="Baishu"><span class="site-author-status" title="Looking for dawn.">â›½ï¸</span></a><div class="site-author-name"><a href="/about/">Baishu</a></div><a class="site-name" href="/about/site.html">Baishuçš„åšå®¢</a><sub class="site-subtitle"></sub><div class="site-desciption"></div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="é¦–é¡µ"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="å½’æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">23</span></a></div><div class="site-state-item"><a href="/categories/" title="åˆ†ç±»"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="æ ‡ç­¾"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">21</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="æ–‡æ¡£"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/lsabella" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:baishu1024@gmail.com" title="E-Mail" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:0.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="æˆ‘çš„å°ä¼™ä¼´ä»¬" style="color:dodgerblue"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%83%8C%E6%99%AF%E6%A6%82%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">èƒŒæ™¯æ¦‚è¿°</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%89%E6%B1%82-amp-%E5%93%AA%E7%A7%8D%E6%96%B9%E5%BC%8F%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">è¯‰æ±‚&amp;å“ªç§æ–¹å¼ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%89%E6%B1%82"><span class="toc-number">2.1.</span> <span class="toc-text">è¯‰æ±‚</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%93%AA%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">å“ªç§æ–¹å¼</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#IndexDB"><span class="toc-number">3.</span> <span class="toc-text">IndexDB</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%B8%BB%E8%A6%81%E6%A6%82%E5%BF%B5"><span class="toc-number">3.2.</span> <span class="toc-text">ä¸»è¦æ¦‚å¿µ</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94mysql"><span class="toc-number">3.3.</span> <span class="toc-text">å¯¹æ¯”mysql</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E6%93%8D%E7%89%B9%E6%80%A7%E6%80%BB%E7%BB%93"><span class="toc-number">3.4.</span> <span class="toc-text">å®æ“ç‰¹æ€§æ€»ç»“</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">3.5.</span> <span class="toc-text">è®¾å¤‡å…¼å®¹æ€§</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E5%AE%B9%E9%87%8F"><span class="toc-number">3.6.</span> <span class="toc-text">å­˜å‚¨å®¹é‡</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%B5%84%E6%BA%90%E9%94%AE-Key"><span class="toc-number">3.7.</span> <span class="toc-text">å­˜å‚¨èµ„æºé”®(Key)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%93%8D%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">3.8.</span> <span class="toc-text">æ“ä½œæµç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.8.1.</span> <span class="toc-text">æ‰“å¼€æ•°æ®åº“</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number">3.8.2.</span> <span class="toc-text">æ–°å»ºæ•°æ®åº“</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B0%E5%A2%9E%E6%95%B0%E6%8D%AE"><span class="toc-number">3.8.3.</span> <span class="toc-text">æ–°å¢æ•°æ®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E6%95%B0%E6%8D%AE"><span class="toc-number">3.8.4.</span> <span class="toc-text">è¯»å–æ•°æ®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E6%95%B0%E6%8D%AE"><span class="toc-number">3.8.5.</span> <span class="toc-text">éå†æ•°æ®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%9B%B4%E6%96%B0%E6%95%B0%E6%8D%AE"><span class="toc-number">3.8.6.</span> <span class="toc-text">æ›´æ–°æ•°æ®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%95%B0%E6%8D%AE"><span class="toc-number">3.8.7.</span> <span class="toc-text">åˆ é™¤æ•°æ®</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95"><span class="toc-number">3.8.8.</span> <span class="toc-text">ä½¿ç”¨ç´¢å¼•</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#idb"><span class="toc-number">3.9.</span> <span class="toc-text">idb</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86QuotaExceededError"><span class="toc-number">3.10.</span> <span class="toc-text">é”™è¯¯å¤„ç†QuotaExceededError</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E6%B8%85%E7%A9%BAindexDB"><span class="toc-number">3.11.</span> <span class="toc-text">æµè§ˆå™¨æ¸…ç©ºindexDB</span></a></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://example.com/2021/03/01/browser/indexdb/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Baishu"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Baishuçš„åšå®¢"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">æµè§ˆå™¨å¦‚ä½•æŒä¹…åŒ–ç¼“å­˜å¤§é‡æ•°æ® - IndexDB</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="åˆ›å»ºæ—¶é—´ï¼š2021-03-01 09:17:21" itemprop="dateCreated datePublished" datetime="2021-03-01T09:17:21+08:00">2021-03-01</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2021-03-05 16:18:31" itemprop="dateModified" datetime="2021-03-05T16:18:31+08:00">2021-03-05</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">æµè§ˆå™¨</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/%E6%B5%8F%E8%A7%88%E5%99%A8/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">æµè§ˆå™¨</span></a><a class="tag-item" href="/tags/%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">æ•°æ®æŒä¹…åŒ–</span></a><a class="tag-item" href="/tags/IndexDB/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">IndexDB</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><h4 id="èƒŒæ™¯æ¦‚è¿°"><a href="#èƒŒæ™¯æ¦‚è¿°" class="headerlink" title="èƒŒæ™¯æ¦‚è¿°"></a>èƒŒæ™¯æ¦‚è¿°</h4><p>  è¿™é‡Œæ‰€è¯´çš„æ•°æ®æŒä¹…åŒ–æ˜¯é’ˆå¯¹æµè§ˆå™¨è€Œè¨€ï¼Œä¹Ÿå¯ç®€ç§°ä¸ºæµè§ˆå™¨ç¼“å­˜ã€‚<br>  æµè§ˆå™¨ç¼“å­˜æ˜¯æŒ‡æµè§ˆå™¨ç«¯åœ¨æœ¬åœ°ä¿å­˜æ•°æ®è¿›è¡Œå¿«é€Ÿè¯»å–ä»¥é¿å…é‡å¤èµ„æºè¯·æ±‚ã€‚<br>  ç°ä»£æµè§ˆå™¨ä¸»è¦æœ‰9ç§ç¼“å­˜æœºåˆ¶ï¼šHttpæ–‡ä»¶ç¼“å­˜ã€LocalStorageã€SessionStorageã€indexDBã€Web SQLã€Cookieã€CacheStorageã€Application Cacheã€Flashç¼“å­˜ - ã€Šç°ä»£å‰ç«¯æŠ€æœ¯è§£æã€‹</p>
<p>ã€Šç°ä»£å‰ç«¯æŠ€æœ¯è§£æã€‹å¯¹åº”æµè§ˆå™¨ï¼š<br><img src="/images/browser/browser_01.png" alt="browser_01" loading="lazy"><br>æ–°æµè§ˆå™¨ï¼š<br><img src="/images/browser/browser_02.png" alt="browser_02" loading="lazy"><br>æœ€æ–°ç‰ˆChromeæµè§ˆå™¨é¢æ¿ä¸­ Application Cache æ²¡æœ‰äº†ï¼Œè§ä¸‹å›¾è§£é‡Šï¼Œæ„Ÿå…´è¶£çš„å¯è‡ªè¡ŒæŸ¥é˜…ğŸ˜Š<br><img src="/images/browser/apply_discard.png" alt="apply_discard" loading="lazy"></p>
<h4 id="è¯‰æ±‚-amp-å“ªç§æ–¹å¼ï¼Ÿ"><a href="#è¯‰æ±‚-amp-å“ªç§æ–¹å¼ï¼Ÿ" class="headerlink" title="è¯‰æ±‚&amp;å“ªç§æ–¹å¼ï¼Ÿ"></a>è¯‰æ±‚&amp;å“ªç§æ–¹å¼ï¼Ÿ</h4><h5 id="è¯‰æ±‚"><a href="#è¯‰æ±‚" class="headerlink" title="è¯‰æ±‚"></a>è¯‰æ±‚</h5><p>  åœ°å›¾map apiè¯·æ±‚å¤§é‡åœ°ç†ä½ç½®jsonï¼Œå½“ç„¶æ¯æ¬¡è®¿é—®é¡µé¢æ—¶è¯·æ±‚ä¹Ÿå¯ï¼Œä½†è¿™ä¸ªä¸æ€ä¹ˆå˜å…¶å®æ˜¯æ²¡å¿…è¦çš„ï¼Œç¼“å­˜åœ¨å„ä¸ªå®¢æˆ·ç«¯æœ¬åœ°å³å¯ï¼Œå®šæœŸæ¸…é™¤å†è·å–æ–°jsonå­˜å‚¨ã€‚å‡å°‘è¯·æ±‚ï¼Œå‡å°‘è´¹ç”¨ï¼Œæœ¬åœ°è¯»å–ï¼Œè¿™æ ·ä¸æ˜¯å¤§å®¶éƒ½å¼€å¿ƒã€‚</p>
<h5 id="å“ªç§æ–¹å¼"><a href="#å“ªç§æ–¹å¼" class="headerlink" title="å“ªç§æ–¹å¼"></a>å“ªç§æ–¹å¼</h5><p>  ç¼“å­˜èµ„æ–™ä¸Šä¼šå»ºè®®ç”¨ä»¥ä¸‹ï¼š</p>
<ul>
<li>For the network resources necessary to load your app and file-based content, use the <a target="_blank" rel="noopener" href="https://web.dev/cache-api-quick-guide/">Cache Storage API</a><br>(part of service workers).</li>
<li>For other data, use <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a> (with a <a target="_blank" rel="noopener" href="https://github.com/jakearchibald/idb">promises wrapper</a>).<br>é‚£ä¸ºå•¥ä¸ç”¨LocalStorageã€SessionStorageï¼Ÿå¯ä»¥å‚è€ƒ <a target="_blank" rel="noopener" href="https://web.dev/storage-for-the-web/">storage-for-the-web</a> æˆ– é˜…è¯»ã€Šç°ä»£å‰ç«¯æŠ€æœ¯è§£æã€‹ç¬¬1.2.3ç« èŠ‚ã€‚</li>
</ul>
<h4 id="IndexDB"><a href="#IndexDB" class="headerlink" title="IndexDB"></a>IndexDB</h4><h5 id="æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æ˜¯ä»€ä¹ˆï¼Ÿ"></a>æ˜¯ä»€ä¹ˆï¼Ÿ</h5><p>  indexedDBæ˜¯å¯ä»¥åœ¨æµè§ˆå™¨ç«¯ä½¿ç”¨çš„æœ¬åœ°æ•°æ®åº“<br>  å¯ä»¥å­˜å‚¨å¤§é‡æ•°æ®ï¼Œæä¾›æ¥å£æ¥æŸ¥è¯¢ï¼Œè¿˜å¯ä»¥å»ºç«‹ç´¢å¼•ï¼Œè¿™äº›éƒ½æ˜¯å…¶ä»–å­˜å‚¨æ–¹æ¡ˆ Cookie æˆ–è€… LocalStorage æ— æ³•æä¾›çš„èƒ½åŠ›<br>  ä»æ•°æ®åº“ç±»å‹æ¥çœ‹ï¼ŒIndexedDB æ˜¯ä¸€ä¸ªéå…³ç³»å‹æ•°æ®åº“ï¼ˆä¸æ”¯æŒé€šè¿‡ SQL è¯­å¥æ“ä½œï¼‰ã€‚</p>
<h5 id="ä¸»è¦æ¦‚å¿µ"><a href="#ä¸»è¦æ¦‚å¿µ" class="headerlink" title="ä¸»è¦æ¦‚å¿µ"></a>ä¸»è¦æ¦‚å¿µ</h5><p>  IndexedDB æ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤æ‚çš„ API ç»„åˆï¼ŒåŒ…æ‹¬ä»¥ä¸‹è¿™äº›( IDB æŒ‡å½“å‰æ“ä½œçš„æ•°æ®åº“å®ä¾‹ )ï¼š</p>
<ol>
<li>æ•°æ®åº“ï¼šIDBDatabase å¯¹è±¡</li>
</ol>
<ul>
<li>æ•°æ®åº“æ˜¯æ‰€æœ‰ç›¸å…³æ•°æ®çš„åŸºæœ¬å®¹å™¨ã€‚åœ¨åŒæºç­–ç•¥ï¼ˆ åè®® + åŸŸå + ç«¯å£ ï¼‰çš„å‰æä¸‹ï¼Œæ¯ä¸ªåŸŸåä¸‹å¯ä»¥æ–°å»ºä»»æ„å¤šçš„æ•°æ®åº“ã€‚IndexedDB ä¸­æœ‰ç‰ˆæœ¬æ¦‚å¿µï¼Œè¿™å°±è§„å®šäº†åŒä¸€æ—¶åˆ»ä¸‹åªæœ‰ä¸€ä¸ªç‰ˆæœ¬çš„æ•°æ®åº“å­˜åœ¨ã€‚</li>
</ul>
<ol start="2">
<li>ä»“åº“å¯¹è±¡ï¼š IDBObjectStore å¯¹è±¡</li>
</ol>
<ul>
<li>å¯¹è±¡ä»“åº“ ObjectStore åœ¨ IndexedDB ä¸­å¯¹åº”çš„æ˜¯ MYSQL ä¸­çš„è¡¨ Tableã€‚</li>
<li>å¯¹è±¡ä»“åº“ä¸­è®°å½•çš„æ˜¯è‹¥å¹²æ¡æ•°æ®ï¼Œæ•°æ®åªæœ‰ä¸»é”®å’Œæ•°æ®ä½“ä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸»é”®ä¸èƒ½é‡å¤ï¼Œå¯ä»¥ä¸ºè‡ªå¢çš„æ•´æ•°ç¼–å·æˆ–è€…æ•°æ®ä¸­æŒ‡å®šçš„ä¸€ä¸ªå±æ€§ã€‚æ•°æ®ä½“å¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œä¸é™äºå¯¹è±¡ã€‚</li>
</ul>
<ol start="3">
<li>ç´¢å¼•ï¼šIDBIndex å¯¹è±¡</li>
</ol>
<ul>
<li>ä¸ºä¸åŒçš„å±æ€§å»ºç«‹ç´¢å¼•å¯ä»¥åŠ å¿«æ•°æ®çš„æ£€ç´¢ã€‚</li>
</ul>
<ol start="4">
<li>äº‹åŠ¡ï¼šIDBTransaction å¯¹è±¡</li>
</ol>
<ul>
<li>æ•°æ®çš„ CURD (å¢åˆ æŸ¥æ”¹) éƒ½è¦é€šè¿‡äº‹åŠ¡æ¥å®Œæˆã€‚</li>
</ul>
<ol start="5">
<li>æ“ä½œè¯·æ±‚ï¼šIDBRequest å¯¹è±¡</li>
<li>æŒ‡é’ˆï¼šIDBCursor å¯¹è±¡</li>
<li>ä¸»é”®ï¼šIDBKeyRange å¯¹è±¡</li>
</ol>
<h5 id="å¯¹æ¯”mysql"><a href="#å¯¹æ¯”mysql" class="headerlink" title="å¯¹æ¯”mysql"></a>å¯¹æ¯”mysql</h5><p><img src="/images/browser/indexdb_database.png" alt="apply_discard" loading="lazy"></p>
<h5 id="å®æ“ç‰¹æ€§æ€»ç»“"><a href="#å®æ“ç‰¹æ€§æ€»ç»“" class="headerlink" title="å®æ“ç‰¹æ€§æ€»ç»“"></a>å®æ“ç‰¹æ€§æ€»ç»“</h5><ol>
<li>key-value çš„å‚¨å­˜å½¢å¼ï¼Œé€è¿‡ç´¢å¼•åŠŸèƒ½æ¥é«˜æ•ˆç‡æœå¯»èµ„æ–™</li>
<li>åŒæºæ”¿ç­– same-origin policyï¼šåªèƒ½å–ç”¨åŒç½‘åŸŸä¸‹çš„èµ„æ–™</li>
<li>Async API : æä¾›å¼‚æ­¥ apiï¼Œå•çº¿ç¨‹çš„åº”ç”¨ä¸‹å–ç”¨èµ„æºæ—¶å°±ä¸ä¼šæœ‰ block the main thread çš„æƒ…å†µé€ æˆä½¿ç”¨è€…ä½“éªŒä¸ä½³</li>
<li>transaction : èƒ½å¤Ÿç¡®ä¿å¤§é‡å†™å…¥èµ„æºæ—¶çš„å®Œæ•´æ€§ï¼Œå¦‚æœæœ‰å•ä¸€èµ„æºå†™å…¥å¤±è´¥å¯å…¨æ•° rollback<h5 id="è®¾å¤‡å…¼å®¹æ€§"><a href="#è®¾å¤‡å…¼å®¹æ€§" class="headerlink" title="è®¾å¤‡å…¼å®¹æ€§"></a>è®¾å¤‡å…¼å®¹æ€§</h5></li>
</ol>
<p>å…¼å®¹æ€§æŸ¥è¯¢ï¼š<a target="_blank" rel="noopener" href="https://caniuse.com/indexeddb">https://caniuse.com/indexeddb</a></p>
<h5 id="å­˜å‚¨å®¹é‡"><a href="#å­˜å‚¨å®¹é‡" class="headerlink" title="å­˜å‚¨å®¹é‡"></a>å­˜å‚¨å®¹é‡</h5><p>  å•ä¸€èµ„æºåº“é¡¹ç›®çš„å®¹é‡/å¤§å°å¹¶æ²¡æœ‰ä»»ä½•é™åˆ¶ï¼Œä½†æ˜¯å„ä¸ª IndexedDBèµ„æºåº“çš„å®¹é‡å°±æœ‰é™åˆ¶ï¼Œä¸”æ ¹æ®å„æµè§ˆå™¨å…¶é™åˆ¶ä¼šä¸åŒã€‚</p>
<ul>
<li><code>Chrome</code> allows the browser to use up to 60% of total disk space. You can use the StorageManager API to determine the maximum quota available. Other Chromium-based browsers may allow the browser to use more storage.</li>
<li><code>Internet Explorer 10 and later</code> can store up to 250MB and will prompt the user when more than 10MB has been used.</li>
<li><code>Firefox </code>allows an origin to use up to 2GB. You can use the StorageManager API to determine how much space is still available.</li>
<li><code>Safari (both desktop and mobile)</code> appears to allow up to 1GB. When the limit is reached, Safari will prompt the user, increasing the limit in 200MB increments. I was unable to find any official documentation on this.<br>å¯å‚è€ƒ <a target="_blank" rel="noopener" href="https://web.dev/storage-for-the-web/">storage-for-the-web</a><h5 id="å­˜å‚¨èµ„æºé”®-Key"><a href="#å­˜å‚¨èµ„æºé”®-Key" class="headerlink" title="å­˜å‚¨èµ„æºé”®(Key)"></a>å­˜å‚¨èµ„æºé”®(Key)</h5></li>
</ul>
<ol>
<li>data type: string, date, floatå’Œ array</li>
<li>å¿…é¡»æ˜¯èƒ½æ’åºçš„å€¼(æ— æ³•å¤„ç†å¤šå›½è¯­è¨€å­—ä¸²æ’åº)</li>
<li>èµ„æºå­˜å‚¨ä¸‰ç§æ–¹å¼äº§ç”Ÿèµ„æºå­˜å‚¨é”®: é”®äº§ç”Ÿå™¨ (key generator)ã€é”®è·¯å¾„ (key path) ä»¥åŠæŒ‡å®šå€¼ã€‚</li>
</ol>
<ul>
<li>é”®äº§ç”Ÿå™¨ (key generator)ï¼š ç”¨äº§ç”Ÿå™¨è‡ªåŠ¨äº§ç”Ÿé”®</li>
<li>é”®è·¯å¾„ (key path)ï¼šç©ºå­—ä¸²æˆ–æ˜¯javascript identifierï¼ˆåŒ…å«ç”¨ â€œ.â€ åˆ†éš”ç¬¦å·çš„åç§°ï¼‰ä¸”è·¯å¾„ä¸èƒ½æœ‰ç©ºç™½</li>
</ul>
<h5 id="æ“ä½œæµç¨‹"><a href="#æ“ä½œæµç¨‹" class="headerlink" title="æ“ä½œæµç¨‹"></a>æ“ä½œæµç¨‹</h5><p>å‚è€ƒ<a target="_blank" rel="noopener" href="https://wangdoc.com/javascript/bom/indexeddb.html#indexeddb-%E5%AF%B9%E8%B1%A1">IndexedDB API</a></p>
<h6 id="æ‰“å¼€æ•°æ®åº“"><a href="#æ‰“å¼€æ•°æ®åº“" class="headerlink" title="æ‰“å¼€æ•°æ®åº“"></a>æ‰“å¼€æ•°æ®åº“</h6><p>IndexedDBä½¿ç”¨ç¬¬ä¸€æ­¥ï¼šæ‰“å¼€æ•°æ®åº“ã€‚<br>æ–¹æ³•ï¼šindexedDB.open()</p>
<pre><code>  var request = window.indexedDB.open(databaseName, version);
</code></pre>
<p>è¿™ä¸ªæ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ•°æ®åº“çš„åå­—ã€‚å¦‚æœæŒ‡å®šçš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œå°±ä¼šæ–°å»ºæ•°æ®åº“ã€‚ç¬¬äºŒä¸ªå‚æ•°æ˜¯æ•´æ•°ï¼Œè¡¨ç¤ºæ•°æ®åº“çš„ç‰ˆæœ¬ã€‚å¦‚æœçœç•¥ï¼Œæ‰“å¼€å·²æœ‰æ•°æ®åº“æ—¶ï¼Œé»˜è®¤ä¸ºå½“å‰ç‰ˆæœ¬ï¼›æ–°å»ºæ•°æ®åº“æ—¶ï¼Œé»˜è®¤ä¸º1ã€‚</p>
<p>indexedDB.open()æ–¹æ³•è¿”å›ä¸€ä¸ª IDBRequest å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡é€šè¿‡ä¸‰ç§äº‹ä»¶errorã€successã€upgradeneededï¼Œå¤„ç†æ‰“å¼€æ•°æ®åº“çš„æ“ä½œç»“æœã€‚</p>
<p>ï¼ˆ1ï¼‰error äº‹ä»¶<br>erroräº‹ä»¶è¡¨ç¤ºæ‰“å¼€æ•°æ®åº“å¤±è´¥ã€‚</p>
<pre><code>    request.onerror = function (event) &#123;
      console.log(&#39;æ•°æ®åº“æ‰“å¼€æŠ¥é”™&#39;);
    &#125;;
</code></pre>
<p>ï¼ˆ2ï¼‰success äº‹ä»¶<br>successäº‹ä»¶è¡¨ç¤ºæˆåŠŸæ‰“å¼€æ•°æ®åº“ã€‚</p>
<pre><code>  var db;

  request.onsuccess = function (event) &#123;
    db = request.result;
    console.log(&#39;æ•°æ®åº“æ‰“å¼€æˆåŠŸ&#39;);
  &#125;;
</code></pre>
<p>è¿™æ—¶ï¼Œé€šè¿‡requestå¯¹è±¡çš„resultå±æ€§æ‹¿åˆ°æ•°æ®åº“å¯¹è±¡ã€‚</p>
<p>ï¼ˆ3ï¼‰upgradeneeded äº‹ä»¶<br>å¦‚æœæŒ‡å®šçš„ç‰ˆæœ¬å·ï¼Œå¤§äºæ•°æ®åº“çš„å®é™…ç‰ˆæœ¬å·ï¼Œå°±ä¼šå‘ç”Ÿæ•°æ®åº“å‡çº§äº‹ä»¶upgradeneededã€‚</p>
<pre><code>  var db;

  request.onupgradeneeded = function (event) &#123;
    db = event.target.result;
  &#125;
</code></pre>
<p>è¿™æ—¶é€šè¿‡äº‹ä»¶å¯¹è±¡çš„target.resultå±æ€§ï¼Œæ‹¿åˆ°æ•°æ®åº“å®ä¾‹ã€‚</p>
<h6 id="æ–°å»ºæ•°æ®åº“"><a href="#æ–°å»ºæ•°æ®åº“" class="headerlink" title="æ–°å»ºæ•°æ®åº“"></a>æ–°å»ºæ•°æ®åº“</h6><p>æ–°å»ºæ•°æ®åº“ä¸æ‰“å¼€æ•°æ®åº“æ˜¯åŒä¸€ä¸ªæ“ä½œã€‚å¦‚æœæŒ‡å®šçš„æ•°æ®åº“ä¸å­˜åœ¨ï¼Œå°±ä¼šæ–°å»ºã€‚ä¸åŒä¹‹å¤„åœ¨äºï¼Œåç»­çš„æ“ä½œä¸»è¦åœ¨upgradeneededäº‹ä»¶çš„ç›‘å¬å‡½æ•°é‡Œé¢å®Œæˆï¼Œå› ä¸ºè¿™æ—¶ç‰ˆæœ¬ä»æ— åˆ°æœ‰ï¼Œæ‰€ä»¥ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚<br>é€šå¸¸ï¼Œæ–°å»ºæ•°æ®åº“ä»¥åï¼Œç¬¬ä¸€ä»¶äº‹æ˜¯æ–°å»ºå¯¹è±¡ä»“åº“ï¼ˆå³æ–°å»ºè¡¨ï¼‰ã€‚</p>
<pre><code>  request.onupgradeneeded = function(event) &#123;
    db = event.target.result;
    var objectStore = db.createObjectStore(&#39;person&#39;, &#123; keyPath: &#39;id&#39; &#125;);
  &#125;
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ•°æ®åº“æ–°å»ºæˆåŠŸä»¥åï¼Œæ–°å¢ä¸€å¼ å«åšpersonçš„è¡¨æ ¼ï¼Œä¸»é”®æ˜¯idã€‚<br>å…ˆåˆ¤æ–­ä¸€ä¸‹ï¼Œè¿™å¼ è¡¨æ ¼æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨å†æ–°å»ºã€‚</p>
<pre><code>  request.onupgradeneeded = function (event) &#123;
    db = event.target.result;
    var objectStore;
    if (!db.objectStoreNames.contains(&#39;person&#39;)) &#123;
      objectStore = db.createObjectStore(&#39;person&#39;, &#123; keyPath: &#39;id&#39; &#125;);
    &#125;
  &#125;
</code></pre>
<p>ä¸»é”®ï¼ˆkeyï¼‰æ˜¯é»˜è®¤å»ºç«‹ç´¢å¼•çš„å±æ€§ã€‚æ¯”å¦‚ï¼Œæ•°æ®è®°å½•æ˜¯{ id: 1, name: â€˜å¼ ä¸‰â€™ }ï¼Œé‚£ä¹ˆidå±æ€§å¯ä»¥ä½œä¸ºä¸»é”®ã€‚ä¸»é”®ä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸‹ä¸€å±‚å¯¹è±¡çš„å±æ€§ï¼Œæ¯”å¦‚{ foo: { bar: â€˜bazâ€™ } }çš„foo.barä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸»é”®ã€‚<br>å¦‚æœæ•°æ®è®°å½•é‡Œé¢æ²¡æœ‰åˆé€‚ä½œä¸ºä¸»é”®çš„å±æ€§ï¼Œé‚£ä¹ˆå¯ä»¥è®© IndexedDB è‡ªåŠ¨ç”Ÿæˆä¸»é”®ã€‚</p>
<pre><code>  var objectStore = db.createObjectStore(
    &#39;person&#39;,
    &#123; autoIncrement: true &#125;
  );
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒæŒ‡å®šä¸»é”®ä¸ºä¸€ä¸ªé€’å¢çš„æ•´æ•°ã€‚<br>æ–°å»ºå¯¹è±¡ä»“åº“ä»¥åï¼Œä¸‹ä¸€æ­¥å¯ä»¥æ–°å»ºç´¢å¼•ã€‚</p>
<pre><code>  request.onupgradeneeded = function(event) &#123;
    db = event.target.result;
    var objectStore = db.createObjectStore(&#39;person&#39;, &#123; keyPath: &#39;id&#39; &#125;);
    objectStore.createIndex(&#39;name&#39;, &#39;name&#39;, &#123; unique: false &#125;);
    objectStore.createIndex(&#39;email&#39;, &#39;email&#39;, &#123; unique: true &#125;);
  &#125;
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒIDBObject.createIndex()çš„ä¸‰ä¸ªå‚æ•°åˆ†åˆ«ä¸ºç´¢å¼•åç§°ã€ç´¢å¼•æ‰€åœ¨çš„å±æ€§ã€é…ç½®å¯¹è±¡ï¼ˆè¯´æ˜è¯¥å±æ€§æ˜¯å¦åŒ…å«é‡å¤çš„å€¼ï¼‰ã€‚</p>
<h6 id="æ–°å¢æ•°æ®"><a href="#æ–°å¢æ•°æ®" class="headerlink" title="æ–°å¢æ•°æ®"></a>æ–°å¢æ•°æ®</h6><p>æ–°å¢æ•°æ®æŒ‡çš„æ˜¯å‘å¯¹è±¡ä»“åº“å†™å…¥æ•°æ®è®°å½•ã€‚è¿™éœ€è¦é€šè¿‡äº‹åŠ¡å®Œæˆã€‚</p>
<pre><code>  function add() &#123;
    var request = db.transaction([&#39;person&#39;], &#39;readwrite&#39;)
      .objectStore(&#39;person&#39;)
      .add(&#123; id: 1, name: &#39;å¼ ä¸‰&#39;, age: 24, email: &#39;zhangsan@example.com&#39; &#125;);

    request.onsuccess = function (event) &#123;
      console.log(&#39;æ•°æ®å†™å…¥æˆåŠŸ&#39;);
    &#125;;

    request.onerror = function (event) &#123;
      console.log(&#39;æ•°æ®å†™å…¥å¤±è´¥&#39;);
    &#125;
  &#125;

  add();
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå†™å…¥æ•°æ®éœ€è¦æ–°å»ºä¸€ä¸ªäº‹åŠ¡ã€‚æ–°å»ºæ—¶å¿…é¡»æŒ‡å®šè¡¨æ ¼åç§°å’Œæ“ä½œæ¨¡å¼ï¼ˆâ€åªè¯»â€æˆ–â€è¯»å†™â€ï¼‰ã€‚æ–°å»ºäº‹åŠ¡ä»¥åï¼Œé€šè¿‡IDBTransaction.objectStore(name)æ–¹æ³•ï¼Œæ‹¿åˆ° IDBObjectStore å¯¹è±¡ï¼Œå†é€šè¿‡è¡¨æ ¼å¯¹è±¡çš„add()æ–¹æ³•ï¼Œå‘è¡¨æ ¼å†™å…¥ä¸€æ¡è®°å½•ã€‚</p>
<p>å†™å…¥æ“ä½œæ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œé€šè¿‡ç›‘å¬è¿æ¥å¯¹è±¡çš„successäº‹ä»¶å’Œerroräº‹ä»¶ï¼Œäº†è§£æ˜¯å¦å†™å…¥æˆåŠŸã€‚</p>
<h6 id="è¯»å–æ•°æ®"><a href="#è¯»å–æ•°æ®" class="headerlink" title="è¯»å–æ•°æ®"></a>è¯»å–æ•°æ®</h6><p>è¯»å–æ•°æ®ä¹Ÿæ˜¯é€šè¿‡äº‹åŠ¡å®Œæˆã€‚</p>
<pre><code>  function read() &#123;
    var transaction = db.transaction([&#39;person&#39;]);
    var objectStore = transaction.objectStore(&#39;person&#39;);
    var request = objectStore.get(1);

    request.onerror = function(event) &#123;
      console.log(&#39;äº‹åŠ¡å¤±è´¥&#39;);
    &#125;;

    request.onsuccess = function( event) &#123;
        if (request.result) &#123;
          console.log(&#39;Name: &#39; + request.result.name);
          console.log(&#39;Age: &#39; + request.result.age);
          console.log(&#39;Email: &#39; + request.result.email);
        &#125; else &#123;
          console.log(&#39;æœªè·å¾—æ•°æ®è®°å½•&#39;);
        &#125;
    &#125;;
  &#125;

  read();
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼ŒobjectStore.get()æ–¹æ³•ç”¨äºè¯»å–æ•°æ®ï¼Œå‚æ•°æ˜¯ä¸»é”®çš„å€¼ã€‚</p>
<h6 id="éå†æ•°æ®"><a href="#éå†æ•°æ®" class="headerlink" title="éå†æ•°æ®"></a>éå†æ•°æ®</h6><p>éå†æ•°æ®è¡¨æ ¼çš„æ‰€æœ‰è®°å½•ï¼Œè¦ä½¿ç”¨æŒ‡é’ˆå¯¹è±¡ IDBCursorã€‚</p>
<pre><code>function readAll() &#123;
  var objectStore = db.transaction(&#39;person&#39;).objectStore(&#39;person&#39;);

  objectStore.openCursor().onsuccess = function (event) &#123;
    var cursor = event.target.result;

    if (cursor) &#123;
      console.log(&#39;Id: &#39; + cursor.key);
      console.log(&#39;Name: &#39; + cursor.value.name);
      console.log(&#39;Age: &#39; + cursor.value.age);
      console.log(&#39;Email: &#39; + cursor.value.email);
      cursor.continue();
    &#125; else &#123;
      console.log(&#39;æ²¡æœ‰æ›´å¤šæ•°æ®äº†ï¼&#39;);
    &#125;
  &#125;;
&#125;

readAll();
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œæ–°å»ºæŒ‡é’ˆå¯¹è±¡çš„openCursor()æ–¹æ³•æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œæ‰€ä»¥è¦ç›‘å¬successäº‹ä»¶ã€‚</p>
<h6 id="æ›´æ–°æ•°æ®"><a href="#æ›´æ–°æ•°æ®" class="headerlink" title="æ›´æ–°æ•°æ®"></a>æ›´æ–°æ•°æ®</h6><p>æ–¹æ³•ï¼šIDBObject.put()</p>
<pre><code>function update() &#123;
  var request = db.transaction([&#39;person&#39;], &#39;readwrite&#39;)
    .objectStore(&#39;person&#39;)
    .put(&#123; id: 1, name: &#39;æå››&#39;, age: 35, email: &#39;lisi@example.com&#39; &#125;);

  request.onsuccess = function (event) &#123;
    console.log(&#39;æ•°æ®æ›´æ–°æˆåŠŸ&#39;);
  &#125;;

  request.onerror = function (event) &#123;
    console.log(&#39;æ•°æ®æ›´æ–°å¤±è´¥&#39;);
  &#125;
&#125;

update();
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œput()æ–¹æ³•è‡ªåŠ¨æ›´æ–°äº†ä¸»é”®ä¸º1çš„è®°å½•ã€‚</p>
<h6 id="åˆ é™¤æ•°æ®"><a href="#åˆ é™¤æ•°æ®" class="headerlink" title="åˆ é™¤æ•°æ®"></a>åˆ é™¤æ•°æ®</h6><p>æ–¹æ³•ï¼šIDBObjectStore.delete()</p>
<pre><code>function remove() &#123;
  var request = db.transaction([&#39;person&#39;], &#39;readwrite&#39;)
    .objectStore(&#39;person&#39;)
    .delete(1);

  request.onsuccess = function (event) &#123;
    console.log(&#39;æ•°æ®åˆ é™¤æˆåŠŸ&#39;);
  &#125;;
&#125;

remove();
</code></pre>
<h6 id="ä½¿ç”¨ç´¢å¼•"><a href="#ä½¿ç”¨ç´¢å¼•" class="headerlink" title="ä½¿ç”¨ç´¢å¼•"></a>ä½¿ç”¨ç´¢å¼•</h6><p>ç´¢å¼•çš„æ„ä¹‰åœ¨äºï¼Œå¯ä»¥è®©ä½ æœç´¢ä»»æ„å­—æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ä»ä»»æ„å­—æ®µæ‹¿åˆ°æ•°æ®è®°å½•ã€‚å¦‚æœä¸å»ºç«‹ç´¢å¼•ï¼Œé»˜è®¤åªèƒ½æœç´¢ä¸»é”®ï¼ˆå³ä»ä¸»é”®å–å€¼ï¼‰ã€‚</p>
<p>å‡å®šæ–°å»ºè¡¨æ ¼çš„æ—¶å€™ï¼Œå¯¹nameå­—æ®µå»ºç«‹äº†ç´¢å¼•ã€‚</p>
<pre><code>objectStore.createIndex(&#39;name&#39;, &#39;name&#39;, &#123; unique: false &#125;);
</code></pre>
<p>ç°åœ¨ï¼Œå°±å¯ä»¥ä»nameæ‰¾åˆ°å¯¹åº”çš„æ•°æ®è®°å½•äº†ã€‚</p>
<pre><code>var transaction = db.transaction([&#39;person&#39;], &#39;readonly&#39;);
var store = transaction.objectStore(&#39;person&#39;);
var index = store.index(&#39;name&#39;);
var request = index.get(&#39;æå››&#39;);

request.onsuccess = function (e) &#123;
  var result = e.target.result;
  if (result) &#123;
    // ...
  &#125; else &#123;
    // ...
  &#125;
&#125;
</code></pre>
<h5 id="idb"><a href="#idb" class="headerlink" title="idb"></a>idb</h5><p><a target="_blank" rel="noopener" href="https://github.com/jakearchibald/idb#indexeddb-with-usability">idb</a><br>ä¸€ä¸ªå¾ˆå°çš„ï¼ˆã€œ1.05kï¼‰åº“ï¼Œä¸»è¦åæ˜ äº†ç´¢å¼•çš„DB APIï¼Œå¯¹å¯ç”¨æ€§æœ‰äº†å¾ˆå¤§çš„æ”¹è¿›ã€‚<br><img src="/images/browser/idb_demo_.gif" alt="idb_demo_" loading="lazy"></p>
<h5 id="é”™è¯¯å¤„ç†QuotaExceededError"><a href="#é”™è¯¯å¤„ç†QuotaExceededError" class="headerlink" title="é”™è¯¯å¤„ç†QuotaExceededError"></a>é”™è¯¯å¤„ç†QuotaExceededError</h5><p>ä½¿ç”¨è€…æµè§ˆå™¨çš„å†…å­˜ä¸è¶³æ—¶ä¼šä¸¢å‡º QuotaExceededError (DOMException) çš„é”™è¯¯ï¼Œ åŠ¡å¿…è®°å¾—handle erroré¿å…ä½¿ç”¨è€…ä½“éªŒä¸å¥½ï¼Œå¹¶ä¾ç…§å„è‡ªé€»è¾‘è¿›è¡Œé”™è¯¯å¤„ç†ã€‚<br>eg. å½“transactionæ—¶å‡ºç°é”™è¯¯ä¼šè°ƒç”¨callback.onabort</p>
<pre><code>// ä»¥ä¸ŠèŒƒä¾‹åŠ ä¸Šerror handler
const transaction = db.transaction([&#39;person&#39;], &#39;readwrite&#39;);
transaction.onabort = function(event) &#123;
  const error = event.target.error; // DOMException
  if (error.name == &#39;QuotaExceededError&#39;) &#123;
    // Fallback code goes here
  &#125;
&#125;;
</code></pre>
<p><img src="/images/browser/quota_error.png" alt="idb_demo_" loading="lazy"></p>
<h5 id="æµè§ˆå™¨æ¸…ç©ºindexDB"><a href="#æµè§ˆå™¨æ¸…ç©ºindexDB" class="headerlink" title="æµè§ˆå™¨æ¸…ç©ºindexDB"></a>æµè§ˆå™¨æ¸…ç©ºindexDB</h5><blockquote>
<p>Web storage is categorized into two buckets, â€œBest Effortâ€ and â€œPersistentâ€</p>
</blockquote>
<p>indexedDB å±äºâ€Best Effortâ€(éå¸¸ä¹…æ€§) å½“æµè§ˆå™¨ç©ºé—´ä¸è¶³æ—¶ä¼šå¼€å§‹æ¸…é™¤éæŒä¹…æ€§èµ„æ–™ ä¹Ÿå°±æ˜¯eviction policy</p>
<ol>
<li>Chromium-based browsers: å½“æµè§ˆå™¨ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå¼€å§‹ä»æœ€å°‘ä½¿ç”¨çš„dataæ¸…é™¤ç›´åˆ°ç©ºé—´ä¸å†è¶…å‡ºé™åˆ¶ã€‚</li>
<li>Internet Explorer 10+: æ²¡æœ‰æ¸…é™¤æœºåˆ¶ï¼Œä½†æ— æ³•å†å†™å…¥æ–°èµ„æ–™ã€‚</li>
<li>Firefox: å½“ç¡¬ç›˜ç©ºé—´ä¸è¶³æ—¶ï¼Œä¼šå¼€å§‹ä»æœ€å°‘ä½¿ç”¨çš„dataæ¸…é™¤ç›´åˆ°ç©ºé—´ä¸å†è¶…å‡ºé™åˆ¶ã€‚</li>
<li>Safari: ä»¥å‰æ²¡æœ‰æ¸…é™¤æœºåˆ¶, ä½†ç°è¡Œæœ‰å®æ–½7æ—¥æœºåˆ¶(å½“ä½¿ç”¨è€…ä¸ƒæ—¥æ²¡æœ‰ä½¿ç”¨safariæ—¶ï¼Œå°†ä¼šæ¸…ç©ºèµ„æ–™)ã€‚</li>
</ol>
<p>å¦‚æœæ˜¯é‡è¦å†…å®¹ï¼š<br>You can request <a target="_blank" rel="noopener" href="https://web.dev/persistent-storage/">persistent storage</a> for your site to protect critical user or application data.</p>
<blockquote>
<p>persistent storageï¼šé™¤éæ˜¯ä½¿ç”¨è€…è‡ªè¡Œæ¸…é™¤ï¼Œä¸ç„¶æ˜¯èƒ½å¤Ÿé¿å…æµè§ˆå™¨çš„è‡ªåŠ¨æ¸…é™¤ã€‚</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/rt2zz/redux-persist">Redux Persist</a>ï¼šPersist and rehydrate a redux store.</p>
<p><img src="/images/browser/redux_persist.png" alt="idb_demo_" loading="lazy"></p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>Baishu</li><li class="post-copyright-link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://example.com/2021/03/01/browser/indexdb/" title="æµè§ˆå™¨å¦‚ä½•æŒä¹…åŒ–ç¼“å­˜å¤§é‡æ•°æ® - IndexDB">http://example.com/2021/03/01/browser/indexdb/</a></li><li class="post-copyright-license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é»˜è®¤é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> è®¸å¯åè®®ã€‚</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2021/03/07/node/nodeanalysis/" rel="prev" title="Node.jsæ€§èƒ½åˆ†æå·¥å…·"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Node.jsæ€§èƒ½åˆ†æå·¥å…·</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2021/03/01/node/http/" rel="next" title="HttpæœåŠ¡å™¨æ€§èƒ½æµ‹è¯•"><span class="post-nav-text">HttpæœåŠ¡å™¨æ€§èƒ½æµ‹è¯•</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>è¦ä¸è¦å’Œæˆ‘è¯´äº›ä»€ä¹ˆï¼Ÿ</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 â€“ 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Baishu</span></div><div class="powered"><span>ç”± <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> é©±åŠ¨ v5.4.0</span><span class="footer-separator">|</span><span>ä¸»é¢˜ - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.2</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>